`Fosfataza alcalina`, `Fosfataza alcalina (grupe)`, `Gama GT`, `Gama GT (grupe)`,
`GOT`, `GOT (grupe)`, `GPT`, `GPT (grupe)`,
`PT (sec)`,`PT (sec) (grupe)`, `PT (%)`, `PT (%) (grupe)`, `INR`, `INR (grupe)`, `APTT  (sec)`, `APTT  (sec) (grupe)`,
`hepa cron (B, C, D, ciroza)`,
`Ciroza`,
`VHB`,
`VHC`,
`Neuro`,
`Renal`,
`Diabet zaharat`,
`Bad outcome`
) %>%
make_summary_table("Sex", g.rows = c("med_range", "mean_sd"),  metadata = metadata,
header=list(lang="en", columns = c('Factor', "Levels", "Total", "Statistics")),
footnote = list(lang="en", values=c("med_range", "mean_sd", "OR/RR", "V")))
# baza_de_date %>%
# filter(`Matching`=="yes") %>%
# my_box(y="Durata bolii", x="Group", z = "Sex", metadata = metadata, range = F, ) +
#   scale_x_discrete(labels=c("E", "A"))+
#   labs(x = "Hepatitis", y='Pre-hospital symptomatic period (days)', main=NULL) + #legend.top_right
#   theme(legend.position = c(1, 1), legend.justification = c(1,1), legend.direction = "vertical", legend.key.size = unit(4, "mm"))
#
#, fig.cap=fig_caption("Fig2","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)")
db <- baza_de_date %>% filter(Group=="E")
wt <- wilcox.test(db$`Varsta`~db$`Sex`)$p.value
# db %>% group_by(`Sex`) %>%
#   dplyr::summarize(N=n(), M=mean(Varsta), SD=sd(Varsta),
#                    Q0=min(Varsta), Q1=quantile(Varsta, 0.25), Q2=median(Varsta), Q3=quantile(Varsta, 0.75), Q4=max(Varsta))
db %>% my_box(y="Varsta", x="Sex", metadata = metadata, range=F) +
labs(subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
wt <- wilcox.test(baza_de_date$`Varsta`~baza_de_date$`Sex`)$p.value
b1 <- baza_de_date %>% my_box(y="Varsta", x="Sex", metadata = metadata, range=F) +
labs(subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b1
dbm <- baza_de_date #%>% filter(`Matching`=="yes")
wt <- wilcox.test(dbm$`BT`~dbm$`Group`)$p.value
b2 <- baza_de_date  %>% my_box(y="BT", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(1.2),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b2
wt <- wilcox.test(dbm$`BD`~dbm$`Group`)$p.value
b3 <- baza_de_date  %>% my_box(y="BD", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(0.3),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b3
wt <- wilcox.test(dbm$`GPT`~dbm$`Group`)$p.value
b4 <- baza_de_date %>% my_box(y="GPT", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(35, 350),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b4
wt <- wilcox.test(dbm$`GOT`~dbm$`Group`)$p.value
b5 <- baza_de_date %>% my_box(y="GOT", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(35, 350),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b5
wt <- wilcox.test(dbm$`PT (sec)`~dbm$`Group`)$p.value
b6 <- baza_de_date %>% my_box(y="PT (sec)", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(9.2, 13.9),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b6
wt <- wilcox.test(dbm$`PT (%)`~dbm$`Group`)$p.value
b7 <- baza_de_date %>%  my_box(y="PT (%)", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(70,130),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
#scale_y_continuous("Prothrombin index (%)", limits=c(10, 130), breaks=seq(0, 200, 25))+
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b7
wt <- wilcox.test(dbm$`INR`~dbm$`Group`)$p.value
b8 <- baza_de_date %>% my_box(y="INR", x="Group", metadata = metadata, range=F) +
geom_hline(yintercept = c(0.8, 1.2),color="red", size=0.25)+
scale_x_discrete(labels=c("E", "A"))+
scale_fill_viridis_d(alpha = 0.75)+scale_color_viridis_d()+
labs(x = "Hepatitis", subtitle = scales::pvalue(wt, add_p=T) ) + no_legend +
#scale_y_continuous("INR", limits=c(0.8, 1.9), breaks=seq(0, 2, 0.2))+
theme(
plot.margin = margin(t=1, b = 1, r = 1, l = 10, unit = "pt"),
panel.grid.major.x = element_blank())
b8
#names(baza_de_date)
#summary(baza_de_date$`INR`)
cat("\n\n")
cat(fig_caption("Fig2","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
p <- cowplot::plot_grid(b2+ theme(text=element_text(family="ArialMT")), b3+ theme(text=element_text(family="ArialMT")), b4+ theme(text=element_text(family="ArialMT")), b5+ theme(text=element_text(family="ArialMT")), b8+ theme(text=element_text(family="ArialMT")),
nrow=1, align="h", axis="tb")  + theme(text=element_text(family="ArialMT")) #%>%
# cowplot::save_plot(filename="figure_2.png", nrow = 1, base_height = 2.5, base_width = 6, dpi=300, )
p
ggsave(filename="figure_2.pdf", device = "pdf", plot = p, width = 6, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_2.cairo.pdf", device = "cairo_pdf", plot = p, width = 6, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_2.svg", device = "svg", plot = p, width = 6, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_2.png", device = "png", plot = p, width = 6, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_2.tiff", device = "tiff", plot = p, width = 6, height = 2.5, units = "in", dpi=300)
cat("\n\n")
cat(fig_caption("Fig1","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
df <- data.frame(`Acute\nhepatitis` = c("E", "A", "B", "C") %>% factor(levels=c("E", "A", "B", "C")),
`2017` = c(1, 88, 12, 1),
`2018` = c(26, 247, 10, 3),
`2019` = c(21, 79, 9, 2) ) %>%
set_colnames(c("Acute\nhepatitis", 2017:2019)) %>%
tidyr::gather("Year", "Cases", -c("Acute\nhepatitis")) %>%
group_by(`Year`, `Acute\nhepatitis`) %>%
summarise(`Cases` = sum(`Cases`)) %>%
mutate(
`Relative Freq` = `Cases`/sum(`Cases`),
`Freq%` = scales::percent(`Relative Freq`),
`Label` = paste(`Cases`, "\n(", `Freq%`, ")", sep=""))
p <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
ggsave(filename="figure_1.pdf", device = "pdf", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo.pdf", device = "cairo_pdf", plot = p, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1.svg", device = "svg", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1.png", device = "png", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1.tiff", device = "tiff", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
p
cat("\n\n")
cat(fig_caption("Fig1","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
df <- data.frame(`Acute\nhepatitis` = c("E", "A", "B", "C") %>% factor(levels=c("E", "A", "B", "C")),
`2017` = c(1, 88, 12, 1),
`2018` = c(26, 247, 10, 3),
`2019` = c(21, 79, 9, 2) ) %>%
set_colnames(c("Acute\nhepatitis", 2017:2019)) %>%
tidyr::gather("Year", "Cases", -c("Acute\nhepatitis")) %>%
group_by(`Year`, `Acute\nhepatitis`) %>%
summarise(`Cases` = sum(`Cases`)) %>%
mutate(
`Relative Freq` = `Cases`/sum(`Cases`),
`Freq%` = scales::percent(`Relative Freq`),
`Label` = paste(`Cases`, "\n(", `Freq%`, ")", sep=""))
p <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
p <- df %>% ggplot(aes(x=`Year`, y=`Freq%`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
df %>% ggplot(aes(x=`Year`, y=`Freq%`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge")
df %>% ggplot(aes(x=`Year`, y=`Freq%`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent")
df %>% ggplot(aes(x=`Year`, y=`Freq%`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, #hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent")
df %>% ggplot(aes(x=`Year`, y=`Freq%`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent")
p <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
cat("\n\n")
cat(fig_caption("Fig1","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
df <- data.frame(`Acute\nhepatitis` = c("E", "A", "B", "C") %>% factor(levels=c("E", "A", "B", "C")),
`2017` = c(1, 88, 12, 1),
`2018` = c(26, 247, 10, 3),
`2019` = c(21, 79, 9, 2) ) %>%
set_colnames(c("Acute\nhepatitis", 2017:2019)) %>%
tidyr::gather("Year", "Cases", -c("Acute\nhepatitis")) %>%
group_by(`Year`, `Acute\nhepatitis`) %>%
summarise(`Cases` = sum(`Cases`)) %>%
mutate(
`Relative Freq` = `Cases`/sum(`Cases`),
`Freq%` = scales::percent(`Relative Freq`),
`Label` = paste(`Cases`, "\n(", `Freq%`, ")", sep=""))
p <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
p <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.1)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p
# ggsave(filename="figure_1.pdf", device = "pdf", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
# #ggsave(filename="figure_1.cairo.pdf", device = "cairo_pdf", plot = p, width = , height = 2.5, units = "in", dpi=300)
# ggsave(filename="figure_1.svg", device = "svg", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
# ggsave(filename="figure_1.png", device = "png", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
# ggsave(filename="figure_1.tiff", device = "tiff", plot = p, width = 2.5, height = 2.5, units = "in", dpi=300)
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.1), labels=scales::percent) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.25), labels=scales::percent) +
legend.top+
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.25), labels=scales::percent) +
guides(fill=guide_legend(nrows=2))+
legend.top +
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.1, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 1), breaks = seq(0, 1, 0.25), labels=scales::percent) +
guides(fill=guide_legend(nrow=2))+
legend.top +
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p1
p1 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p1
p3 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p3
p3 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.5, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p3
p2
cat("\n\n")
cat(fig_caption("Fig1","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
df <- data.frame(`Acute\nhepatitis` = c("E", "A", "B", "C") %>% factor(levels=c("E", "A", "B", "C")),
`2017` = c(1, 88, 12, 1),
`2018` = c(26, 247, 10, 3),
`2019` = c(21, 79, 9, 2) ) %>%
set_colnames(c("Acute\nhepatitis", 2017:2019)) %>%
tidyr::gather("Year", "Cases", -c("Acute\nhepatitis")) %>%
group_by(`Year`, `Acute\nhepatitis`) %>%
summarise(`Cases` = sum(`Cases`)) %>%
mutate(
`Relative Freq` = `Cases`/sum(`Cases`),
`Freq%` = scales::percent(`Relative Freq`),
`Label` = paste(`Cases`, "\n(", `Freq%`, ")", sep=""))
p1 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p1
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.5, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("% Cases", limits = c(0, 1), breaks = seq(0, 1, 0.25), labels=scales::percent) +
guides(fill=guide_legend(nrow=2))+
legend.top +
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p3 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.5, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p3
ggsave(filename="figure_1_v1.pdf", device = "pdf", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v1.pdf", device = "cairo_pdf", plot = p, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.svg", device = "svg", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.png", device = "png", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.tiff", device = "tiff", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.pdf", device = "pdf", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v2.pdf", device = "cairo_pdf", plot = p2, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.svg", device = "svg", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.png", device = "png", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.tiff", device = "tiff", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.pdf", device = "pdf", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v3.pdf", device = "cairo_pdf", plot = p3, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.svg", device = "svg", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.png", device = "png", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.tiff", device = "tiff", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
cat("\n\n")
cat(fig_caption("Fig1","(diamords denote means, p-value according to Wilcoxon rank sum test with continuity correction.)"))
cat("\n\n")
# cowplot::plot_grid(b1, b2, b4, b5, b7,
#                    nrow=1, align="h", axis="tb")
df <- data.frame(`Acute\nhepatitis` = c("E", "A", "B", "C") %>% factor(levels=c("E", "A", "B", "C")),
`2017` = c(1, 88, 12, 1),
`2018` = c(26, 247, 10, 3),
`2019` = c(21, 79, 9, 2) ) %>%
set_colnames(c("Acute\nhepatitis", 2017:2019)) %>%
tidyr::gather("Year", "Cases", -c("Acute\nhepatitis")) %>%
group_by(`Year`, `Acute\nhepatitis`) %>%
summarise(`Cases` = sum(`Cases`)) %>%
mutate(
`Relative Freq` = `Cases`/sum(`Cases`),
`Freq%` = scales::percent(`Relative Freq`),
`Label` = paste(`Cases`, "\n(", `Freq%`, ")", sep=""))
p1 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Freq%`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=-0.1, vjust=0.5, angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p1
p2 <- df %>% ggplot(aes(x=`Year`, y=`Relative Freq`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.5, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("% Cases", limits = c(0, 1), breaks = seq(0, 1, 0.25), labels=scales::percent) +
guides(fill=guide_legend(nrow=2))+
legend.top +
no.title.x  + theme(text=element_text(family="ArialMT"))
p2
p3 <- df %>% ggplot(aes(x=`Year`, y=`Cases`, fill = `Acute\nhepatitis`)) +
geom_bar(stat="identity", position = "dodge") +
geom_text(aes(label=`Cases`), position = position_dodge2(1), show.legend = F,
size=2.75, hjust=0.5, vjust=-0.5, #angle=90,
label.padding=unit(1, "mm"), label.size = unit(0, "mm"), fill="transparent") +
scale_fill_viridis_d(direction = -1)+
scale_y_continuous("Cases", limits = c(0, 300), breaks = seq(0, 300, 50)) +
no.title.x  + theme(text=element_text(family="ArialMT"))
p3
ggsave(filename="figure_1_v1.pdf", device = "pdf", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v1.pdf", device = "cairo_pdf", plot = p, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.svg", device = "svg", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.png", device = "png", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v1.tiff", device = "tiff", plot = p1, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.pdf", device = "pdf", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v2.pdf", device = "cairo_pdf", plot = p2, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.svg", device = "svg", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.png", device = "png", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v2.tiff", device = "tiff", plot = p2, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.pdf", device = "pdf", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
#ggsave(filename="figure_1.cairo_v3.pdf", device = "cairo_pdf", plot = p3, width = , height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.svg", device = "svg", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.png", device = "png", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
ggsave(filename="figure_1_v3.tiff", device = "tiff", plot = p3, width = 2.5, height = 2.5, units = "in", dpi=300)
vars <- c("Group",
"hepa cron (B, C, D, ciroza)",
"Neuro",
"Renal",
"Diabet zaharat",
"Bad outcome")
db <- baza_de_date %>% select(vars) %>%
set_colnames(make.names(vars)) %>%
na.omit() %>% mutate_all(fct_rev)
model <- glm(data=db, formula="Group~" %+% paste(make.names(vars)[-1], collapse="+"), family = "binomial")
ci <- confint(model)
model %>% #car::vif()
broom::tidy() %>%
cbind(ci) %>%
mutate(
`Effect` = `term`,#c("intercept", v, "Sex (M)", "Varsta"),
`beta ±SE` = scales::number(`estimate`, 0.001)  %+% " ±" %+% scales::number(`std.error`, 0.01),
#`Adj OR` = scales::number(exp(`estimate`), 0.01),
`Adj OR` = limit_between(exp(`estimate`), to.string = T) %+%
" [" %+% limit_between(exp(`2.5 %`), to.string = T) %+%
" to " %+% limit_between(exp(`97.5 %`), to.string = T) %+% "]",
`p (signif.)` = scales::pvalue(`p.value`)  %+% " " %+% pstars(`p.value`)
) %>%
select(c("Effect", "beta ±SE", "Adj OR", "p (signif.)")) %>%
mutate(`Effect` = metadata.var_to_labels(vars %>% str_replace_all("Group", "(intercept)"), metadata) ) %>%
flextable::flextable()
model %>% #car::vif()
broom::tidy() %>%
cbind(ci) %>%
mutate(
`Effect` = `term`,#c("intercept", v, "Sex (M)", "Varsta"),
`beta ±SE` = scales::number(`estimate`, 0.001)  %+% " ±" %+% scales::number(`std.error`, 0.01),
#`Adj OR` = scales::number(exp(`estimate`), 0.01),
`Adj OR` = limit_between(exp(`estimate`), to.string = T) %+%
" [" %+% limit_between(exp(`2.5 %`), to.string = T) %+%
" to " %+% limit_between(exp(`97.5 %`), to.string = T) %+% "]",
`p (signif.)` = scales::pvalue(`p.value`)  %+% " " %+% pstars(`p.value`)
)
ci
ci <- confint(model)
model %>% #car::vif()
broom::tidy() %>%
cbind(ci)
model %>% #car::vif()
broom::tidy() %>%
cbind(ci)
model %>% #car::vif()
broom::tidy() %>%
cbind(ci) %>%
mutate(
`Effect` = `term`,#c("intercept", v, "Sex (M)", "Varsta"),
`beta ±SE` = scales::number(`estimate`, 0.001)  %+% " ±" %+% scales::number(`std.error`, 0.01),
#`Adj OR` = scales::number(exp(`estimate`), 0.01),
`Adj OR` = limit_between(exp(`estimate`), to.string = T) %+%
" [" %+% limit_between(exp(`2.5 %`), to.string = T) %+%
" to " %+% limit_between(exp(`97.5 %`), to.string = T) %+% "]",
`p (signif.)` = scales::pvalue(`p.value`)  %+% " " %+% pstars(`p.value`)
)
